<!DOCTYPE html>
<html>
<head>
	<title>My JavaScript Project</title>
	
	<script src="https://components.connect.trimble.com/trimble-connect-workspace-api/index.js"></script>
	
	<script src="https://unpkg.com/xdomain@0.8.2/dist/xdomain.min.js"></script>
</head>
<body>
<!-- <script src="https://jonathang89.github.io/TrimbleConnectTest/script.js"/> -->

<script type="text/javascript">
   xdomain.slaves({
    "https://pset-api.connect.trimble.com": "/v1/proxy.html",
    "https://org-api.connect.trimble.com": "/v1/proxy.html",
  });
    console.log("Test log");
    	
    getData();

    async function getData() {
     const API = await TrimbleConnectWorkspace.connect(window.parent, (event, data) => {
        console.log("Event: ", event, data);
     });

     console.log("Window Parent: ", window.parent);
     
     const responseProject = await API.project.getProject();
     console.log("Response Project: ", responseProject); // Trimble Connect project details
     const projectId = responseProject.id;
     
     const responseAccessToken = await API.extension.requestPermission("accesstoken");
     console.log("responseAccessToken: ", responseAccessToken);
     const accessToken = responseAccessToken;

     const psetBaseString = 'https://pset-api.connect.trimble.com/v1/';
     const orgBaseString = "https://org-api.connect.trimble.com/v1/";
// Test part
    
     const viewerModel = Array.from(await API.viewer.getModels());

     console.log("viewerModel: ", viewerModel);
    //  console.log("viewerObject: ", viewerModel);

     const projectForestString = orgBaseString.concat(`forests/project:${projectId}:data/trees/ProjectContext/nodes/PSetLibs`);

   //   const psetLibsString = psetBaseString.concat(libLinkString);

     console.log("debut test: ");

     const responsePset = await fetch(projectForestString, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${accessToken}`
        }
     });

     console.log("response forest json:", await responsePset.json());

     const libId = responsePset.json().links[0].substring(7);

     console.log("libId: ", libId);
     
    }
 </script>
	
</body>
</html>
